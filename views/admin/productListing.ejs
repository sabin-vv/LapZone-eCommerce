<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LapZone Dashboard - Products</title>
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="/css/customerslist.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
.add-product-btn{
        background: black;
        height: 40px;
    }
    
    /* Custom Select Arrow Styling */
    .filter select, .sort select {
        padding-right: 2.5rem !important;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e") !important;
        background-position: right 0.75rem center !important;
        background-repeat: no-repeat !important;
        background-size: 1.25em 1.25em !important;
        appearance: none !important;
        -webkit-appearance: none !important;
        -moz-appearance: none !important;
    }
    
    .filter select, .sort select {
        background-color: white !important;
        color: #374151 !important;
        transition: border-color 0.2s, box-shadow 0.2s !important;
        font-weight: 500 !important;
    }
    
    .filter select:focus, .sort select:focus {
        outline: none !important;
        border-color: #3b82f6 !important;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
    }
    
    .filter select:hover, .sort select:hover {
        border-color: #9ca3af !important;
    }
    
    .search-form {
        display: flex !important;
        gap: 0.5rem !important;
        align-items: center !important;
        flex-wrap: wrap !important;
    }
    
    .search-form input {
        flex: 1 !important;
        min-width: 200px !important;
        padding: 0.75rem 1rem !important;
        border: 1px solid #d1d5db !important;
        border-radius: 6px !important;
        font-size: 0.875rem !important;
        background-color: white !important;
        transition: border-color 0.2s, box-shadow 0.2s !important;
    }
    
    .search-form input:focus {
        outline: none !important;
        border-color: #3b82f6 !important;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
    }
    
    .search-btn {
        background-color: #3b82f6 !important;
        color: white !important;
        border: none !important;
        padding: 0.75rem 1rem !important;
        border-radius: 6px !important;
        cursor: pointer !important;
        font-size: 0.875rem !important;
        font-weight: 500 !important;
        transition: background-color 0.2s !important;
        white-space: nowrap !important;
    }
    
    .search-btn:hover {
        background-color: #2563eb !important;
    }
    
    .clear-btn {
        background-color: #6b7280 !important;
        color: white !important;
        border: none !important;
        padding: 0.75rem 1rem !important;
        border-radius: 6px !important;
        cursor: pointer !important;
        font-size: 0.875rem !important;
        font-weight: 500 !important;
        transition: background-color 0.2s !important;
        white-space: nowrap !important;
    }
    
    .clear-btn:hover {
        background-color: #4b5563 !important;
    }
    
    /* Action Bar Responsive Styles */
    .action-bar {
        display: flex !important;
        justify-content: flex-end !important;
        align-items: center !important;
        margin-bottom: 20px !important;
        flex-wrap: wrap !important;
        gap: 1rem !important;
        padding: 0 1rem !important;
    }
    
    .add-product-btn {
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
        padding: 0.75rem 1.5rem !important;
        color: white !important;
        border: none !important;
        border-radius: 8px !important;
        cursor: pointer !important;
        font-size: 0.875rem !important;
        font-weight: 600 !important;
        transition: all 0.2s ease !important;
        white-space: nowrap !important;
        min-height: 44px !important;
    }
    
    .add-product-btn:hover {
        background-color: #1f2937 !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
    }
    
    /* Filter Sort Container Responsive Styles */
    .filter-sort {
        display: flex !important;
        justify-content: space-between !important;
        align-items: flex-start !important;
        flex-wrap: wrap !important;
        gap: 1rem !important;
        padding: 1.5rem !important;
        margin-bottom: 1rem !important;
        background: #f8fafc !important;
        border-radius: 12px !important;
        border: 1px solid #e2e8f0 !important;
    }
    
    .filter {
        display: flex !important;
        gap: 0.75rem !important;
        flex: 1 !important;
        max-width: 600px !important;
        flex-wrap: wrap !important;
    }
    
    .filter select {
        flex: 1 !important;
        min-width: 140px !important;
        padding: 0.75rem 1rem !important;
        border: 1px solid #d1d5db !important;
        border-radius: 8px !important;
        font-size: 0.875rem !important;
        font-weight: 500 !important;
        background-color: white !important;
        transition: all 0.2s ease !important;
    }
    
    .sort {
        display: flex !important;
        gap: 0.75rem !important;
        flex: 1 !important;
        max-width: fit-content !important;
        min-width: 300px !important;
    }
    
    .search-container {
        width: 100% !important;
    }
    
    /* Responsive breakpoints */
    @media (max-width: 1200px) {
        .filter-sort {
            flex-direction: column !important;
            align-items: stretch !important;
        }
        
        .filter {
            max-width: none !important;
            margin-bottom: 1rem !important;
        }
        
        .sort {
            max-width: none !important;
            min-width: auto !important;
        }
    }
    
    @media (max-width: 768px) {
        .action-bar {
            justify-content: center !important;
            padding: 0 0.5rem !important;
        }
        
        .add-product-btn {
            width: 100% !important;
            max-width: 300px !important;
            justify-content: center !important;
        }
        
        .filter-sort {
            padding: 1rem !important;
            gap: 1rem !important;
        }
        
        .filter {
            flex-direction: column !important;
            gap: 0.75rem !important;
            margin-bottom: 1rem !important;
        }
        
        .filter select {
            width: 100% !important;
            min-width: auto !important;
        }
        
        .sort {
            flex-direction: column !important;
            gap: 0.75rem !important;
        }
        
        .search-form {
            flex-direction: column !important;
            align-items: stretch !important;
            gap: 0.75rem !important;
        }
        
        .search-form input {
            min-width: auto !important;
            width: 100% !important;
        }
        
        .search-btn, .clear-btn {
            width: 100% !important;
            padding: 0.875rem 1rem !important;
        }
    }
    
    @media (max-width: 480px) {
        .action-bar {
            margin-bottom: 15px !important;
        }
        
        .add-product-btn {
            font-size: 0.8rem !important;
            padding: 0.625rem 1.25rem !important;
        }
        
        .filter-sort {
            padding: 0.75rem !important;
            margin-bottom: 0.75rem !important;
        }
        
        .filter select {
            padding: 0.625rem 0.875rem !important;
            font-size: 0.8rem !important;
        }
        
        .search-form input {
            padding: 0.625rem 0.875rem !important;
            font-size: 0.8rem !important;
        }
        
        .search-btn, .clear-btn {
            padding: 0.75rem 1rem !important;
            font-size: 0.8rem !important;
        }
    }
    
    /* Enhanced hover and focus states */
    .filter select:focus, .sort select:focus {
        outline: none !important;
        border-color: #3b82f6 !important;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
        transform: translateY(-1px) !important;
    }
    
    .filter select:hover, .sort select:hover {
        border-color: #9ca3af !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05) !important;
    }
    
    /* Loading states and animations */
    .filter select, .sort select {
        transition: all 0.2s ease !important;
    }
    
    .search-form input:focus {
        outline: none !important;
        border-color: #3b82f6 !important;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
        transform: translateY(-1px) !important;
    }
    
    .search-btn:active, .clear-btn:active {
        transform: translateY(0) !important;
    }
    
    /* Button icon spacing */
    .search-btn i, .clear-btn i {
        margin-right: 0.5rem !important;
        font-size: 0.75rem !important;
    }
    
    /* Additional responsive table styles */
    .table-container {
        overflow-x: auto !important;
        border-radius: 12px !important;
        border: 1px solid #e2e8f0 !important;
        background: white !important;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
    }
    
    /* Product table responsive styles */
    .product-table {
        width: 100% !important;
        border-collapse: collapse !important;
        min-width: 800px !important;
    }
    
    .product-table th,
    .product-table td {
        padding: 12px 8px !important;
        text-align: left !important;
        border-bottom: 1px solid #e2e8f0 !important;
        vertical-align: middle !important;
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
    }
    
    .product-table th {
        background-color: #f8fafc !important;
        font-weight: 600 !important;
        color: #374151 !important;
        font-size: 0.875rem !important;
        text-transform: uppercase !important;
        letter-spacing: 0.05em !important;
    }
    
    .product-table td {
        font-size: 0.875rem !important;
        color: #4b5563 !important;
    }
    
    /* Specific column widths */
    .product-table th:nth-child(1),
    .product-table td:nth-child(1) {
        width: 80px !important;
        min-width: 80px !important;
    }
    
    .product-table th:nth-child(2),
    .product-table td:nth-child(2) {
        width: 200px !important;
        min-width: 200px !important;
        max-width: 200px !important;
        white-space: normal !important;
        word-wrap: break-word !important;
        line-height: 1.4 !important;
    }
    
    .product-table th:nth-child(3),
    .product-table td:nth-child(3) {
        width: 120px !important;
        min-width: 120px !important;
        max-width: 120px !important;
    }
    
    .product-table th:nth-child(4),
    .product-table td:nth-child(4) {
        width: 100px !important;
        min-width: 100px !important;
        text-align: right !important;
    }
    
    .product-table th:nth-child(5),
    .product-table td:nth-child(5) {
        width: 80px !important;
        min-width: 80px !important;
        text-align: center !important;
    }
    
    .product-table th:nth-child(6),
    .product-table td:nth-child(6) {
        width: 80px !important;
        min-width: 80px !important;
        text-align: center !important;
    }
    
    .product-table th:nth-child(7),
    .product-table td:nth-child(7) {
        width: 100px !important;
        min-width: 100px !important;
        text-align: center !important;
    }
    
    .product-table th:nth-child(8),
    .product-table td:nth-child(8) {
        width: 120px !important;
        min-width: 120px !important;
        text-align: center !important;
    }
    
    /* Product image styling */
    .product-table .product-image {
        width: 3rem !important;
        height: 3rem !important;
        object-fit: cover !important;
        border-radius: 6px !important;
        border: 1px solid #e2e8f0 !important;
    }
    
    /* Product name styling */
    .product-table .product-name {
        font-weight: 500 !important;
        color: #1f2937 !important;
        display: -webkit-box !important;
        -webkit-box-orient: vertical !important;
        overflow: hidden !important;
        line-height: 1.4 !important;
        max-height: 2.8em !important;
    }
    
    /* Category styling */
    .product-table .product-category {
        background-color: #f3f4f6 !important;
        color: #374151 !important;
        padding: 0.25rem 0.5rem !important;
        border-radius: 4px !important;
        font-size: 0.75rem !important;
        font-weight: 500 !important;
        display: inline-block !important;
        max-width: 100% !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
    }
    
    /* Price styling */
    .product-table .product-price {
        font-weight: 600 !important;
        color: #059669 !important;
    }
    
    /* Stock styling */
    .product-table .product-stock {
        font-weight: 500 !important;
    }
    
    .product-table .stock-low {
        color: #dc2626 !important;
    }
    
    .product-table .stock-medium {
        color: #d97706 !important;
    }
    
    .product-table .stock-high {
        color: #059669 !important;
    }
    
    /* Action buttons styling */
    .action-buttons {
        display: flex !important;
        gap: 0.5rem !important;
        align-items: center !important;
        justify-content: center !important;
    }
    
    .edit-btn, .delete-btn {
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 2rem !important;
        height: 2rem !important;
        border-radius: 6px !important;
        border: none !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
    }
    
    .edit-btn {
        background-color: #3b82f6 !important;
        color: white !important;
    }
    
    .edit-btn:hover {
        background-color: #2563eb !important;
        transform: translateY(-1px) !important;
    }
    
    .delete-btn {
        background-color: #ef4444 !important;
        color: white !important;
    }
    
    .delete-btn:hover {
        background-color: #dc2626 !important;
        transform: translateY(-1px) !important;
    }
    
    /* Offer section styling */
    .offer-section {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        gap: 0.25rem !important;
    }
    
    .offer-badge {
        color: #ef4444 !important;
        font-weight: 600 !important;
        font-size: 0.75rem !important;
        background-color: #fef2f2 !important;
        padding: 0.125rem 0.375rem !important;
        border-radius: 4px !important;
        border: 1px solid #fecaca !important;
    }
    
    .offer-add-btn, .offer-remove-btn {
        border: none !important;
        padding: 0.25rem 0.5rem !important;
        border-radius: 4px !important;
        font-size: 0.75rem !important;
        cursor: pointer !important;
        font-weight: 500 !important;
        transition: all 0.2s ease !important;
    }
    
    .offer-add-btn {
        background-color: #10b981 !important;
        color: white !important;
    }
    
    .offer-add-btn:hover {
        background-color: #059669 !important;
    }
    
    .offer-remove-btn {
        background-color: #dc2626 !important;
        color: white !important;
    }
    
    .offer-remove-btn:hover {
        background-color: #b91c1c !important;
    }
    
    @media (max-width: 768px) {
        .search-btn i, .clear-btn i {
            display: none !important;
        }
        
        .search-btn, .clear-btn {
            font-size: 0.875rem !important;
        }
        
        /* Mobile table adjustments */
        .product-table {
            min-width: 600px !important;
        }
        
        .product-table th,
        .product-table td {
            padding: 8px 4px !important;
            font-size: 0.8rem !important;
        }
        
        .product-table th:nth-child(2),
        .product-table td:nth-child(2) {
            width: 150px !important;
            min-width: 150px !important;
            max-width: 150px !important;
        }
        
        .product-table th:nth-child(3),
        .product-table td:nth-child(3) {
            width: 100px !important;
            min-width: 100px !important;
            max-width: 100px !important;
        }
        
        .action-buttons {
            flex-direction: column !important;
            gap: 0.25rem !important;
        }
        
        .edit-btn, .delete-btn {
            width: 1.75rem !important;
            height: 1.75rem !important;
        }
        
        .offer-section {
            gap: 0.125rem !important;
        }
        
        .offer-add-btn, .offer-remove-btn {
            padding: 0.125rem 0.375rem !important;
            font-size: 0.625rem !important;
        }
        
        .offer-badge {
            font-size: 0.625rem !important;
            padding: 0.0625rem 0.25rem !important;
        }
    }
    
    @media (max-width: 480px) {
        .search-btn, .clear-btn {
            font-size: 0.8rem !important;
            padding: 0.75rem !important;
        }
        
        .product-table {
            min-width: 500px !important;
        }
        
        .product-table th,
        .product-table td {
            padding: 6px 3px !important;
            font-size: 0.75rem !important;
        }
        
        .product-table th:nth-child(2),
        .product-table td:nth-child(2) {
            width: 120px !important;
            min-width: 120px !important;
            max-width: 120px !important;
        }
        
        .product-image {
            width: 2rem !important;
            height: 2rem !important;
        }
        
        .edit-btn, .delete-btn {
            width: 1.5rem !important;
            height: 1.5rem !important;
        }
        
        .edit-btn svg, .delete-btn svg {
            width: 12px !important;
            height: 12px !important;
        }
    }
</style>
</head>
<body>
    <%- include("../partials/admin/header.ejs") %>
    <div class="customer-dashboard">
        <%- include("../partials/admin/sidebar.ejs") %>
        <main class="main-content">
            <div class="breadcrumb">
                <a href="/admin/dashboard">Dashboard</a>
                <span>›</span>
                <span>Products</span>
            </div>
            <header class="header">
                <h2><i class="fa-solid fa-box" style="color: #0446e5;"></i> Products</h2>
            </header>
            
            <div class="container mx-auto p-6">
                <div class="customers">
                    <div class="products">
                        <div class="action-bar">
                            <button class="add-product-btn" onclick="window.location.href='/admin/product/add'">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                </svg>
                                Add Product
                            </button>
                        </div>

                        <div class="filter-sort">
                            <div class="filter">
                                <select name="category">
                                    <option value="">Category</option>
                                    <% categories.forEach(category => { %>
                                        <option value="<%= category.name %>" <%= category.name === (query.category || '') ? 'selected' : '' %>><%= category.name %></option>
                                    <% }) %>
                                </select>
                                <select name="price">
                                    <option value="">Price Range</option>
                                    <option value="0-50000" <%= query.price === '0-50000' ? 'selected' : '' %>>₹0 - ₹50,000</option>
                                    <option value="50000-100000" <%= query.price === '50000-100000' ? 'selected' : '' %>>₹50,000 - ₹1,00,000</option>
                                    <option value="100000+" <%= query.price === '100000+' ? 'selected' : '' %>>₹1,00,000+</option>
                                </select>
                                <select name="sort">
                                    <option value="price-desc" <%= query.sort === 'price-desc' ? 'selected' : '' %>>Price: High to Low</option>
                                    <option value="price-asc" <%= query.sort === 'price-asc' ? 'selected' : '' %>>Price: Low to High</option>
                                    <option value="added-desc" <%= query.sort === 'added-desc' ? 'selected' : '' %>>Recently Added</option>
                                </select>
                            </div>
                            <div class="sort">
                                <div class="search-container">
                                    <form action="/admin/products" method="get" class="search-form">
                                        <input type="text" name="search" placeholder="Search by name, category, or brand..." value="<%= searchQuery || '' %>">
                                        <button type="submit" class="search-btn">
                                            <i class="fas fa-search"></i>
                                            Search
                                        </button>
                                        <button type="button" class="clear-btn" onclick="window.location.href='/admin/products'">
                                            <i class="fas fa-times"></i>
                                            Clear
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="table-container">
                            <table class="product-table" id="productTable">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Product Name</th>
                                        <th>Category</th>
                                        <th>Price</th>
                                        <th>Stock</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                        <th>Offer</th>
                                    </tr>
                                </thead>
                                <tbody id="productList">
                                    <% products.forEach(product => { %>
                                        <% 
                                            const totalStock = product.variants && product.variants.length > 0
                                                ? product.variants.reduce((sum, v) => sum + (v.stock || 0), 0)
                                                : 0;
                                            let stockClass = 'stock-high';
                                            if (totalStock <= 5) stockClass = 'stock-low';
                                            else if (totalStock <= 20) stockClass = 'stock-medium';
                                        %>
                                        <tr>
                                            <td>
                                                <img src="<%= product.images.find(image => image.isMain)?.url || '/images/placeholder.jpg' %>" 
                                                     alt="<%= product.name %>" 
                                                     class="product-image">
                                            </td>
                                            <td>
                                                <div class="product-name" title="<%= product.name %>">
                                                    <%= product.name %>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="product-category" title="<%= product.categoryId.name %>">
                                                    <%= product.categoryId.name %>
                                                </span>
                                            </td>
                                            <td>
                                                <span class="product-price">
                                                    ₹<%= product.salePrice.toLocaleString('en-IN') %>
                                                </span>
                                            </td>
                                            <td>
                                                <span class="product-stock <%= stockClass %>">
                                                    <%= totalStock %>
                                                </span>
                                            </td>
                                            <td>
                                                <label class="switch">
                                                    <input type="checkbox" <%= product.isActive ? "checked" : "" %> onchange="toggleProduct('<%= product._id %>', this)">
                                                    <span class="slider"></span>
                                                </label>
                                            </td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button onclick="editProduct('<%= product._id %>')" class="edit-btn" title="Edit Product">
                                                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                                            <path d="M12.146 0.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                                                        </svg>
                                                    </button>
                                                    <button onclick="deleteProduct('<%= product._id %>')" class="delete-btn" title="Delete Product">
                                                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                                            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11a1 1 0 0 1 0 2H2.5z"/>
                                                        </svg>
                                                    </button>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="offer-section">
                                                    <% if (product.offer) { %>
                                                        <span class="offer-badge">
                                                            <%= product.offer %>% OFF
                                                        </span>
                                                        <button onclick="removeOffer('<%= product._id %>')" class="offer-remove-btn">
                                                            Remove
                                                        </button>
                                                    <% } else { %>
                                                        <button onclick="addOffer('<%= product._id %>')" class="offer-add-btn">
                                                            Add Offer
                                                        </button>
                                                    <% } %>
                                                </div>
                                            </td>
                                        </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>

                        <div class="pagination">
                            <% if (currentPage > 1) { %>
                                <a href="?page=<%= currentPage - 1 %>&category=<%= query.category || '' %>&price=<%= query.price || '' %>&sort=<%= query.sort || '' %>" class="border rounded px-3 py-2">Previous</a>
                            <% } %>
                            <% for (let i = 1; i <= totalPages; i++) { %>
                                <a href="?page=<%= i %>&category=<%= query.category || '' %>&price=<%= query.price || '' %>&sort=<%= query.sort || '' %>" class="border rounded px-3 py-2 <%= currentPage === i ? 'active' : '' %>"><%= i %></a>
                            <% } %>
                            <% if (currentPage < totalPages) { %>
                                <a href="?page=<%= currentPage + 1 %>&category=<%= query.category || '' %>&price=<%= query.price || '' %>&sort=<%= query.sort || '' %>" class="border rounded px-3 py-2">Next</a>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script>
        function editProduct(productId) {
            console.log(`Edit product: ${productId}`);
            window.location.href = `/admin/product/edit/${productId}`;
        }

        function deleteProduct(productId) {
            Swal.fire({
                title: 'Are you sure?',
                text: 'You won\'t be able to revert this!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/admin/product/delete/${productId}`, { method: 'POST' })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                Swal.fire(
                                    'Deleted!',
                                    'Product has been deleted.',
                                    'success'
                                ).then(() => {
                                    window.location.reload();
                                });
                            } else {
                                Swal.fire(
                                    'Error!',
                                    'Failed to delete product.',
                                    'error'
                                );
                            }
                        })
                        .catch(error => {
                            console.error('Error deleting product:', error);
                            Swal.fire(
                                'Error!',
                                'An error occurred while deleting the product.',
                                'error'
                            );
                        });
                }
            });
        }

        function addOffer(productId) {
            Swal.fire({
                title: 'Add Offer',
                text: 'Enter offer percentage (0-99):',
                input: 'number',
                inputAttributes: {
                    min: 0,
                    max: 99,
                    step: 1
                },
                showCancelButton: true,
                confirmButtonText: 'Add Offer',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                inputValidator: (value) => {
                    if (!value || value < 0 || value > 99) {
                        return 'Please enter a valid percentage (0-99)';
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const offerPercentage = parseInt(result.value);
                    fetch(`/admin/product/add-offer/${productId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ offer: offerPercentage })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire(
                                'Success!',
                                `Offer of ${offerPercentage}% added.`,
                                'success'
                            ).then(() => {
                                window.location.reload();
                            });
                        } else {
                            Swal.fire(
                                'Error!',
                                'Failed to add offer.',
                                'error'
                            );
                        }
                    })
                    .catch(error => {
                        console.error('Error adding offer:', error);
                        Swal.fire(
                            'Error!',
                            'An error occurred while adding the offer.',
                            'error'
                        );
                    });
                }
            });
        }

        function removeOffer(productId) {
            Swal.fire({
                title: 'Remove Offer',
                text: 'Are you sure you want to remove the offer?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, remove it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/admin/product/remove-offer/${productId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire(
                                'Success!',
                                'Offer has been removed.',
                                'success'
                            ).then(() => {
                                window.location.reload();
                            });
                        } else {
                            Swal.fire(
                                'Error!',
                                'Failed to remove offer.',
                                'error'
                            );
                        }
                    })
                    .catch(error => {
                        console.error('Error removing offer:', error);
                        Swal.fire(
                            'Error!',
                            'An error occurred while removing the offer.',
                            'error'
                        );
                    });
                }
            });
        }

        function toggleProduct(productId, checkbox) {
            const isActive = checkbox.checked;
            const actionText = isActive ? 'list' : 'unlist';
            
            Swal.fire({
                title: `Are you sure you want to ${actionText} this product?`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: `Yes, ${actionText} it!`
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/admin/product-toggle/${productId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ isActive })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire(
                                'Success!',
                                `Product has been ${actionText}ed.`,
                                'success'
                            );
                        } else {
                            checkbox.checked = !isActive;
                            Swal.fire(
                                'Error!',
                                'Failed to toggle product status.',
                                'error'
                            );
                        }
                    })
                    .catch(error => {
                        console.error('Error toggling product:', error);
                        checkbox.checked = !isActive;
                        Swal.fire(
                            'Error!',
                            'An error occurred while toggling the product.',
                            'error'
                        );
                    });
                } else {
                    checkbox.checked = !isActive;
                }
            });
        }

        document.querySelectorAll('.filter select, .sort select').forEach(select => {
            select.addEventListener('change', function() {
                const category = document.querySelector('select[name="category"]').value;
                const price = document.querySelector('select[name="price"]').value;
                const sort = document.querySelector('select[name="sort"]').value;
                window.location.href = `/admin/products?page=1&category=${category}&price=${price}&sort=${sort}`;
            });
        });
    </script>
</body>
</html>